# 見積書・請求書作成システム (Google Apps Script)

## 📄 概要

Googleスプレッドシート上のボタン操作により、入力された顧客情報・明細データを元に「見積書」または「請求書」をPDFとして生成し、指定されたメールアドレスに送信する自動化処理をGoogle Apps Script（GAS）で実装したシステムです。

## 🚀 セットアップ手順

### 1. Google Apps Scriptプロジェクトの作成

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「見積書請求書システム」に変更

### 2. スクリプトファイルの追加

以下のファイルをGoogle Apps Scriptプロジェクトに追加してください：

- **Code.gs** - メイン処理
- **Config.gs** - 設定定数
- **Utils.gs** - ユーティリティ関数

### 3. Googleスプレッドシートの作成と連携

1. 新しいGoogleスプレッドシートを作成
2. Google Apps Scriptの「リソース」→「このスクリプトに関連付けられたスプレッドシート」で連携

### 4. 初期セットアップの実行

1. Google Apps Scriptエディタで `initialSetup` 関数を実行
2. 必要な権限を許可
3. 入力シートとテンプレートシートが自動作成されます

### 5. 送信ボタンの設定

1. 入力シートのB19セルを選択
2. 「挿入」→「図形描画」でボタンを作成
3. ボタンに「送信」と入力
4. ボタンを右クリック→「スクリプトを割り当て」→ `sendDocument` を入力

### 6. フォルダ構造の準備

スプレッドシートと同じフォルダに以下のフォルダを作成してください：
- **見積書** - 見積書PDFの保存先
- **請求書** - 請求書PDFの保存先
- **バックアップ** - 送信記録の保存先

## 📝 使用方法

### 1. 基本情報の入力

入力シートで以下の項目を入力してください：

| 項目 | セル | 必須 | 説明 |
|------|------|------|------|
| 書類種別 | B2 | ✅ | 「見積書」または「請求書」 |
| 発行日 | B3 | ✅ | 書類の発行日 |
| 書類番号 | B4 | ✅ | 3桁の数字（例：001, 123） |
| 宛先会社名 | B5 | ✅ | 送付先の会社名 |
| 担当者名 | B6 | - | 担当者名 |
| 住所 | B7 | - | 会社住所 |
| メールアドレス | B8 | ✅ | 送付先メールアドレス |
| 備考 | B9 | - | 追加事項 |

### 2. 商品明細の入力

A10:D14の範囲に商品情報を入力してください：

| 列 | 項目 | 説明 |
|----|------|------|
| A | 品目 | 商品・サービス名 |
| B | 数量 | 数量 |
| C | 単価 | 単価（円） |
| D | 小計 | 数量×単価 |

### 3. 合計金額の入力

| 項目 | セル | 説明 |
|------|------|------|
| 小計 | F15 | 商品明細の合計 |
| 消費税 | F16 | 消費税額 |
| 合計 | F17 | 税込み合計額 |

### 4. 機能の実行方法

#### メニューから実行（推奨）

スプレッドシートを開くと、自動的に「見積書・請求書システム」メニューが追加されます。以下の機能を利用できます：

- **📄 書類作成・送信**: メインの見積書・請求書作成機能
- **🧮 合計計算**: 商品明細の合計金額を自動計算
- **🧹 入力データクリア**: 入力されたデータをすべてクリア
- **📋 宛名履歴表示**: 過去に使用した宛先会社名を表示・選択
- **⚙️ システム状態確認**: 必要なシートやフォルダの存在確認
- **🔧 初期セットアップ**: 新しいスプレッドシートの初期設定

#### 書類作成の手順

1. すべての必須項目を入力
2. メニューから「📄 書類作成・送信」を選択（またはボタンをクリック）
3. 送信確認ダイアログで「はい」をクリック
4. メール送信確認ダイアログで選択：
   - 「はい」: PDFを作成・保存・メール送信
   - 「いいえ」: PDFを作成・保存のみ（メール送信なし）
5. 処理完了まで待機

📧 **メール送信オプション**: メールアドレスを入力した場合でも、送信するかどうかを選択できます。

## 🔧 設定のカスタマイズ

### 発行元情報の変更

`Config.gs`ファイルの以下の部分を編集してください：

```javascript
EMAIL: {
  SENDER_COMPANY: '株式会社サンプル',    // 会社名
  SENDER_DEPARTMENT: '営業部',          // 部署名
  SENDER_NAME: '山田太郎'              // 担当者名
}
```

### セル位置の変更

`CONFIG.CELLS`や`CONFIG.TEMPLATE_CELLS`で各項目のセル位置を変更できます。

### メールテンプレートの変更

`Code.gs`の`sendEmailWithPDF`関数内でメールの件名と本文を変更できます。

## 📋 機能一覧

- ✅ **自動メニュー生成**: スプレッドシート開封時に主要機能のメニューを自動追加
- ✅ PDF生成（見積書・請求書）
- ✅ メール送信の選択式実行（メール送信する/しないを選択可能）
- ✅ PDFファイルの自動保存
- ✅ 書類番号による管理（3桁の数字で指定）
- ✅ ファイル名の統一形式（[書類種別]-[日付]-[書類番号]-[会社名].pdf）
- ✅ 送信履歴の記録（メール送信有無も記録）
- ✅ Google Docsでのバックアップ
- ✅ エラーハンドリング
- ✅ 入力データの検証

## 🔍 トラブルシューティング

### よくある問題

1. **「権限が必要です」エラー**
   - Google Apps Scriptの実行権限を許可してください

2. **「メールアドレスが無効です」エラー**
   - メールアドレスの形式を確認してください

3. **「フォルダが見つかりません」エラー**
   - 必要なフォルダ（見積書、請求書、バックアップ）を作成してください

4. **PDF生成エラー**
   - テンプレートシートが存在することを確認してください
   - セル参照が正しいことを確認してください

### ログの確認

Google Apps Scriptエディタの「実行の記録」でエラーログを確認できます。

## 📞 サポート

問題が発生した場合は、以下の情報を含めてお問い合わせください：

- エラーメッセージ
- 入力データの内容
- 実行ログ（Google Apps Scriptの実行の記録）

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🔄 バージョン履歴

- **v1.0.0** - 初回リリース
  - 基本的な見積書・請求書作成機能
  - PDF生成・メール送信機能
  - 送信履歴・バックアップ機能